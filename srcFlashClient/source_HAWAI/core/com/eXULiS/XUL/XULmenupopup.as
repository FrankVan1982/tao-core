import com.eXULiS.XUL.XULelement;import mx.transitions.Tween;import mx.utils.Delegate;class com.eXULiS.XUL.XULmenupopup extends XULelement {	private var _obj:MovieClip;	private var childs_ar:Array;	var background_mc:MovieClip;	var myTfield_tf:TextField;	var gap_nb:Number;	var refHeight_nbr:Number;	var mask_mc:MovieClip;	var back_mc:MovieClip;	var backGround_mc:MovieClip;	var childsNumber_nb:Number;	var menubar;	var myTweenX;	var myTweenY;		function XULmenupopup(xulParent,xulDef:XMLNode) {		super(xulParent,xulDef);		trace("XULmenupopup: relay given to XULelement with xulParent = " + xulParent);	}		function create(){		trace("XULmenupopup: create menu popup (" + _objDef.attributes["id"] + ") on " + _objParent + " on depth: " + _objParent._childNextDepth);				_objParent.createEmptyMovieClip(_objDef.attributes["id"],800);				_obj = super.create(_obj,this,1);		refHeight_nbr=_objParent._exulis.refHeight_nbr;		childsNumber_nb=_objDef.childNodes.length;			trace("XULmenupopup: special properties setting");		gap_nb=5;		// register childs		childs_ar=new Array();				menubar=_objParent._exulis.menubar;				_objParent._exulis.addEntry(this);				setLayout();		return _obj;	}		private function setLayout(){		trace("XULpopup: _obj "+_obj);				_obj._y = refHeight_nbr;		_obj._x = 0;		_obj._visible=false;	}		private function createMask(color_nb,depth_nb,alpha_nb):MovieClip	{			var myState_mc=_obj.createEmptyMovieClip("myBackGround"+depth_nb,depth_nb);		myState_mc.beginFill(color_nb,alpha_nb);		myState_mc.moveTo(0,0);		myState_mc.lineTo(50,0);		myState_mc.lineTo(50,10);		myState_mc.lineTo(0,10);		myState_mc.lineTo(0,0);		myState_mc.endFill();		myState_mc._width=_obj._width+20;		myState_mc._height=_obj._height+10;		return myState_mc;	}		public function addEntry(myChild):Void	{		if(_objParent._exulis._type = "menulist"){			_objParent._exulis.addMenuItem(myChild.getMenuItem());		}		childs_ar.push(myChild);		dispatchItem();				// display background and mask 		// as soon as number of childs is reached				if (childs_ar.length>=childsNumber_nb)		{			back_mc=createMask(0xABABAB,2,100);			mask_mc=createMask(0xFF00FF,890,100);			_obj.setMask(mask_mc);									back_mc.onRollOver=Delegate.create(this, onBackMenuRollOver);			back_mc.onRollOver=Delegate.create(this, onBackMenuRollOut);			back_mc.useHandCursor=false;						for (var j in childs_ar)			{				if (childs_ar[j]._objDef.nodeName == "menuseparator"){				var _childObj=childs_ar[j]._obj				childs_ar[j].overState_mc._width=_obj._width-20;				_childObj._width=_obj._width-26;				_childObj._x=3;				//_childObj._x=(_obj._width/2)-((_childObj._width/2));				}			}		}	}		private function onBackMenuRollOver(){	menubar.navigationUnderMouse_bool=true;	}		private function onBackMenuRollOut(){	menubar.navigationUnderMouse_bool=false;	}			public function menuAnimation()	{	myTweenX.stop();	myTweenY.stop();		myTweenX=new Tween(mask_mc,"_width",null,0,mask_mc._width,5);	myTweenY=new Tween(mask_mc,"_height",null,0,mask_mc._height,5);	}				private function dispatchItem()	{				var _xCoord_nb=20;		var _yCoord_nb=3;		var _childsLength_nb:Number=childs_ar.length;				for (var a=0;a<_childsLength_nb;a++)		{			var _childObj=childs_ar[a]._obj			_childObj._x=_xCoord_nb;			_childObj._y=_yCoord_nb;			_yCoord_nb+= (childs_ar[a]._objDef.nodeName == "menuseparator") ? 7 : _childObj._height+5;											}	}		}