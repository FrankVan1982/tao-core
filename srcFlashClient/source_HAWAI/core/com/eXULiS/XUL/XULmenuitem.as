import com.eXULiS.XUL.XULelement;import mx.utils.Delegate;class com.eXULiS.XUL.XULmenuitem extends XULelement {		var _obj:MovieClip;	var hitZone_mc:MovieClip;	var overState_mc:MovieClip;	var myTfield_tf:TextField;	var gap_nb:Number;	var label_str:String;	var menubar;	var currentType;	var menuInitObj_obj:Object;		private var _attrDisabled_str:String;		function XULmenuitem(xulParent,xulDef:XMLNode) {		super(xulParent,xulDef);		trace("XULmenuitem: relay given to XULelement with xulParent = " + xulParent);	}	function create(){		trace("XULmenuitem: create " + _objDef.nodeName + " (" + _objDef.attributes["id"] + ") on " + _objParent + " on depth: " + _objParent._childNextDepth);		_objParent.createEmptyMovieClip(_objDef.attributes["id"],_objParent._childNextDepth+600);// complete the object definition with the ancestor class definition		_obj = super.create(_obj,this,1);// not relevant/*        _obj.move(left,top);        _obj.setSize(width,height);*/// attach local properties		trace("XULmenuitem: special properties setting");		menuInitObj_obj = new Object();		if(_objDef.attributes["label"] != undefined){			menuInitObj_obj.label = toolbox.wrapRun(_objDef.attributes["label"], _guiSource,"SingleNode","String");		}		else{			menuInitObj_obj.label = "???";		};		if(_objDef.attributes["type"] != undefined){			menuInitObj_obj.type = (_objDef.attributes["type"] == "checkbox") ? "check" : _objDef.attributes["type"];		};		if(_objDef.nodeName == "menuseparator"){			menuInitObj_obj.type = "separator";			menuInitObj_obj.label = "-";		};		if(_objDef.attributes["value"] != undefined){			menuInitObj_obj.instanceName = _objDef.attributes["value"];		};		if(_objDef.attributes["name"] != undefined){			menuInitObj_obj.groupName = _objDef.attributes["name"];		};		if(_objDef.attributes["selected"] != undefined) {			menuInitObj_obj.selected = (_objDef.attributes["selected"] == "true") ? true : false;		};		if(_objDef.attributes["disabled"] != undefined){			menuInitObj_obj.enabled = ((_objDef.attributes["disabled"] == "true") || (_objDef.attributes["disabled"] == true)) ? false : true;		};		if(_actions.length > 0){			menuInitObj_obj.actions = _actions;		}		label_str=toolbox.wrapRun(_objDef.attributes["label"], _guiSource,"SingleNode","String")+" ";				_attrDisabled_str=_objDef.attributes["disabled"].toLowerCase();		menubar=_objParent._exulis.menubar;				if(_objDef.nodeName == "menuseparator"){			currentType="menuseparator";		} 		else{			setTextEntry();			}		// interactivity				_obj.onRollOver=Delegate.create(this, onMenuOver);		_obj.onRollOut=Delegate.create(this, onMenuOut);		_obj.onPress=Delegate.create(this, onMenuPress);		_obj.onRelease=Delegate.create(this, onMenuRelease);		_obj.onReleaseOutside=Delegate.create(this, onMenuReleaseOutside);				_obj.useHandCursor=false;				if (_attrDisabled_str!="true" && currentType!="menuseparator")		{			// overState			overState_mc=createHitState(0x666666,6,100);			overState_mc._visible=false;			} 				if (currentType=="menuseparator")		{			createSeparator();		}				// register childs		_objParent._exulis.addEntry(this);		return _obj;	}	public function getMenuItem():Object{		return menuInitObj_obj;	}		public function setActive()	{						_attrDisabled_str="false";						myTfield_tf.htmlText="<font face='Arial'size='12' color='#000000'>"+label_str+"</font>";			_obj.enabled=true;			_obj.onRollOver=Delegate.create(this, onMenuOver);			_obj.onRollOut=Delegate.create(this, onMenuOut);			_obj.onPress=Delegate.create(this, onMenuPress);			_obj.onRelease=Delegate.create(this, onMenuRelease);			_obj.onReleaseOutside=Delegate.create(this, onMenuReleaseOutside);						// overState						overState_mc=createHitState(0x666666,6,100);			overState_mc._visible=false;	}		public function setInactive()	{						_attrDisabled_str="true";					_obj.enabled=false;			delete _obj.onRollOver;			delete _obj.onRollOut;			delete _obj.onPress;			delete _obj.onRelease;			delete _obj.onReleaseOutside;			overState_mc.removeMovieClip();						myTfield_tf.htmlText="<font face='Arial'size='12' color='#888888'>"+label_str+"</font>";	}	private function createSeparator()	{		var separator_mc=_obj.createEmptyMovieClip("mySeparator",333);		separator_mc.lineStyle(0, 0x777777, 100);		separator_mc.moveTo(0,0);		separator_mc.lineTo(2,0);		separator_mc.lineStyle(0, 0xFFFFFF, 80);		separator_mc.moveTo(0,1);		separator_mc.lineTo(2,1);	}		private function onMenuOver()	{		if(_attrDisabled_str != "true" && currentType!="menuseparator"){		overState_mc._visible=true;		overState_mc._width=_objParent._exulis.back_mc._width;		overState_mc._x=-20;		overState_mc._y=myTfield_tf._y-3;		overState_mc._height=myTfield_tf._height+5;		myTfield_tf.htmlText="<font face='Arial'size='12' color='#ffffff' >"+label_str+"</font>";		}		menubar.navigationUnderMouse_bool=true;				var _currentSelection=eval(Selection.getFocus()).text.substring(Selection.getBeginIndex(),Selection.getEndIndex());				if (Selection.getBeginIndex()!=-1 && Selection.getFocus()!=undefined)		{		var _mySelection = eval(Selection.getFocus()).text.substring(Selection.getBeginIndex(),Selection.getEndIndex());		this._targetExecutionLayer.currentSelection = (this._targetExecutionLayer.currentSelection!=undefined) ? this._targetExecutionLayer.currentSelection : "";		this._targetExecutionLayer.currentSelection= (_mySelection!=undefined) ? _mySelection : this._targetExecutionLayer.currentSelection;		this._targetExecutionLayer.currentFocusedField=eval(Selection.getFocus());		var _mySelectedField=this._targetExecutionLayer.currentFocusedField;		this._targetExecutionLayer.pasteFieldBeginIndex=Selection.getBeginIndex();		this._targetExecutionLayer.pasteFieldEndIndex=Selection.getEndIndex();		trace("myCB begin "+this._targetExecutionLayer.pasteFieldBeginIndex);		trace("myCB begin "+this._targetExecutionLayer.pasteFieldEndIndex);		}					}			private function onMenuRelease()	{					}		private function onMenuOut()	{		if(_attrDisabled_str != "true" && currentType!="menuseparator"){		overState_mc._visible=false;		myTfield_tf.htmlText="<font face='Arial'size='12' color='#000000' >"+label_str+"</font>";		} else		{			myTfield_tf.htmlText="<font face='Arial'size='12' color='#888888' >"+label_str+"</font>";		}		menubar.navigationUnderMouse_bool=false;		trace("myCLICK > onMenuOut > menuitem"+menubar.navigationUnderMouse_bool);	}		private function onMenuPress()	{					if(_attrDisabled_str != "true" && currentType!="menuseparator"){			menubar.manageMenuDisplay("all");					trace("feedTrace for MENUITEM, Stimulus: " + "key"+_root.FEEDTRACE_PAYLOAD_ATTRIBUTE_NAME_VALUE_SEPARATOR+_objDef.attributes["key"]);			_level0.currentItemRootLevel.feedTrace("MENUITEM","key"+_root.FEEDTRACE_PAYLOAD_ATTRIBUTE_NAME_VALUE_SEPARATOR+_objDef.attributes["key"],"stimulus");						for(var vCpt_num:Number = 0;vCpt_num < _actions.length;vCpt_num++){				var vAction_obj:Object = _actions[vCpt_num];				if(vAction_obj.type == "command"){					toolbox.wrapRun(vAction_obj.action,this);														}			}						overState_mc._visible=false;			myTfield_tf.htmlText="<font face='Arial'size='12' color='#000000'>"+label_str+"</font>";			menubar.navigationUnderMouse_bool=false;						if(_attrDisabled_str == "true")			{			myTfield_tf.htmlText="<font face='Arial'size='12' color='#888888'>"+label_str+"</font>";			}						trace("myCLICK > onMenuPress > menuitem"+menubar.navigationUnderMouse_bool);					} else			{					menubar.navigationUnderMouse_bool=true;				trace("myCLICK > onMenuPress > menuitem"+menubar.navigationUnderMouse_bool);			}					}		private function onMenuReleaseOutside()	{		if (_attrDisabled_str != "true" && currentType!="menuseparator")		{		overState_mc._visible=false;		myTfield_tf.htmlText="<font face='Arial'size='12' color='#000000' >"+label_str+"</font>";		menubar.navigationUnderMouse_bool=false;		} else		{				myTfield_tf.htmlText="<font face='Arial'size='12' color='#888888' >"+label_str+"</font>";		}		trace("myCLICK > onMenuOut > menuitem"+menubar.navigationUnderMouse_bool);	}		private function createHitState(color_nb,depth_nb,alpha_nb):MovieClip	{				var _myWidth_nb=myTfield_tf._width+gap_nb;		var _myHeight_nb=myTfield_tf._height+5;				var myState_mc=_obj.createEmptyMovieClip("myState"+depth_nb,depth_nb);				myState_mc.beginFill(color_nb,alpha_nb);		myState_mc.moveTo(0,0);		myState_mc.lineTo(2,0);		myState_mc.lineTo(2,10);		myState_mc.lineTo(0,10);		myState_mc.lineTo(0,0);		myState_mc.endFill();				return myState_mc;						}		private function setTextEntry():Void	{		myTfield_tf=_obj.createTextField("myText",10,0,0,10,10);		myTfield_tf.autoSize=true;		myTfield_tf.backGround=true;		myTfield_tf.selectable=false;		myTfield_tf.html=true;								if(_attrDisabled_str == "true"){		myTfield_tf.htmlText="<font face='Arial'size='12' color='#888888'>"+label_str+"</font>";		} else			{				myTfield_tf.htmlText="<font face='Arial'size='12' color='#000000'>"+label_str+"</font>";			}	}									}