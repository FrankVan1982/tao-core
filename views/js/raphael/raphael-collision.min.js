if(!Array.prototype.filter){Array.prototype.filter=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array();var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e}}function analyse_path(f,h){for(var e=0;e<f.length;e++){var c=f[e];switch(c[0]){case"a":break;case"t":break;case"q":break;case"s":break;case"c":break;case"v":var g=c[1]+h.current_point.y;h.point_list.push(["s",[h.current_point.x,h.current_point.y],[h.current_point.x,g]]);break;case"V":var g=c[1];h.point_list.push(["s",[h.current_point.x,h.current_point.y],[h.current_point.x,g]]);break;case"h":var a=c[1]+h.current_point.x;h.point_list.push(["s",[h.current_point.x,h.current_point.y],[a,h.current_point.y]]);break;case"H":var a=c[1];h.point_list.push(["s",[h.current_point.x,h.current_point.y],[a,h.current_point.y]]);break;case"l":var a=parseInt(c[1])+h.current_point.x;var g=parseInt(c[2])+h.current_point.y;h.point_list.push(["s",[h.current_point.x,h.current_point.y],[a,g]]);break;case"L":h.point_list.push(["s",[h.current_point.x,h.current_point.y],[c[1],c[2]]]);break;case"Z":case"z":var b=h.point_list[0].x;var d=h.point_list[0].y;h.point_list.push(["s",[h.current_point.x,h.current_point.y],[c[1],c[2]]]);h.current_point.x=c[1];h.current_point.y=c[2];break;case"m":case"M":h.current_point.x=c[1];h.current_point.y=c[2];break}}return}function visit_vml(e){var c=new Array();if((typeof(e)=="object")&&(e.length)){for(var d=0;d<e.length;d++){c=c.concat(visit_vml(e[d]))}}else{switch(e.type){case"path":var a=new Array();var f={current_point:{x:0,y:0},point_list:a};c.push(analyse_path(e.d),f);break;case"circle":c.push(["circle",{radius:e.attrs.r,cx:e.attrs.cx,cy:e.attrs.cy},e]);break;case"rect":var b=[{x:e.attrs.x,y:e.attrs.y},{x:e.attrs.x+e.attrs.width,y:e.attrs.y},{x:e.attrs.x+e.attrs.width,y:e.attrs.y+e.attrs.height},{x:e.attrs.x,y:e.attrs.y+e.attrs.height},];c.push(["rect",b,e]);break}}return c}function find_curves_in_path(d){var c=false;var b=0;var a=d.length;while((!c)&&(b<a)){if(d[b][0] in ["a","A","c","C","s","S","q","Q","t","T"]){}b++}return c}function visit_svg(e){var c=new Array();if((typeof(e)=="object")&&(e.length)){for(var d=0;d<e.length;d++){c=c.concat(visit_svg(e[d]))}}else{switch(e.type){case"path":var a=new Array();var f={current_point:{x:0,y:0},point_list:a};console.log(e);if(find_curves_in_path(e.attrs.path)){c.push(["path_c",analyse_path(e.attrs.path,f),f,e])}else{c.push(["path_s",analyse_path(e.attrs.path,f),f,e])}break;case"circle":c.push(["circle",{radius:e.node.r.animVal.value,cx:e.node.cx.animVal.value,cy:e.node.cy.animVal.value},e]);break;case"image":case"rect":var b=[{x:e.node.x.animVal.value,y:e.node.y.animVal.value},{x:e.node.x.animVal.value+e.node.width.animVal.value,y:e.node.y.animVal.value},{x:e.node.x.animVal.value+e.node.width.animVal.value,y:e.node.y.animVal.value+e.node.height.animVal.value},{x:e.node.x.animVal.value,y:e.node.y.animVal.value+e.node.height.animVal.value},];c.push(["rect",b,e]);break}}return c}function populate_polygons(c,b){var a=new Array();if(c.raphael.svg){a=visit_svg(b)}else{a=visit_vml(b)}return a}function raphaelcollision(j,b,i,g){var e=new Array();var h=populate_polygons(j,b);var c=h.length;for(var d=0;d<c;d++){var a=h[d];switch(a[0]){case"circle":if(collide_circle(a[1],i,g)){e.push(a)}break;case"rect":if(collide_polygon(a[1],i,g)){e.push(a)}break;default:}}return e}function collide_polygon(f,a,h){var g=false;f=f.filter(function(i,c,j){return i!=null});var b=f.length;var d=b-1;for(var e=-1;++e<b;d=e){if(((f[e].y<=h&&h<f[d].y)||(f[d].y<=h&&h<f[e].y))&&(a<(f[d].x-f[e].x)*(h-f[e].y)/(f[d].y-f[e].y)+f[e].x)){g=!g}}return g}function collide_circle(b,a,c){return(b.radius>Math.sqrt((b.cx-a)*(b.cx-a)+(b.cy-c)*(b.cy-c)))};